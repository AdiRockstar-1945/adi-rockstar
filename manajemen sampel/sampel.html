<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Manajemen Sampel</title>
  <link rel="stylesheet" href="sampel.css" />
</head>
<body>
    <div class="nav">
    <button class="btn-sidebar" onclick="openSide()">
      <img src="logo-removebg-preview.png" alt="" class="logo">
    </button>
    <h1>...</h1>
  </div>

  <div class="section">
    <div class="sidebar" id="sidebar">
    <h2>Lab Navigator</h2>
    <div class="menu-item active"><i class="fas fa-home"></i><a href="../dasbor/beranda.html">Dashboard</a></div>
    <div class="menu-item"><i class="fas fa-user-injured"></i><a href="../input/input.html"> Pasien & Permintaan</a></div>
    <div class="menu-item"><i class="fas fa-vial"></i><a href="../manajemen sampel/sampel.html"> Manajemen Sampel</a></div>
    <div class="menu-item"><i class="fas fa-microscope"></i><a href="../hasil/hasil.html">Pemeriksaan & Hasil</a></div>
    <div class="menu-item"><i class="fas fa-file-alt"></i><a href="../laporan/laporan.html">Pelaporan</a></div>
    <div class="menu-item"><i class="fas fa-flask"></i><a href="../alat/man alat.html">Alat & Reagen</a></div>
    <div class="menu-item"><i class="fas fa-cogs"></i><a href="../pengaturan/setting.html">Pengaturan</a></div>
  </div>

   <div class="container">
    <h1>Manajemen Sampel</h1>

    <!-- Simulasi Barcode Scan -->
    <div class="form-section">
      <label for="barcodeInput">Scan Barcode:</label>
      <input type="text" id="barcodeInput" placeholder="Masukkan kode sampel..." onkeyup="searchByBarcode()" />
    </div>

    <!-- Filter Section -->
    <div class="filters">
      <input type="date" id="filterTanggal" onchange="applyFilter()" />
      <select id="filterStatus" onchange="applyFilter()">
        <option value="">Semua Status</option>
        <option value="diambil">Diambil</option>
        <option value="sentrifugasi">Sentrifugasi</option>
        <option value="diuji">Diuji</option>
        <option value="selesai">Selesai</option>
      </select>
      <input type="text" id="filterPasien" placeholder="Cari nama pasien..." onkeyup="applyFilter()" />
      <input type="text" id="filterUji" placeholder="Cari nama uji..." onkeyup="applyFilter()" />
    </div>

    <!-- Tabel Data Sampel -->
    <table id="sampelTable">
      <thead>
        <tr>
          <th>Barcode</th>
          <th>Pasien</th>
          <th>Uji</th>
          <th>Tanggal</th>
          <th>Status</th>
          <th>Waktu Input</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="sampelBody">
        <!-- Data akan di-generate JS -->
      </tbody>
    </table>
  </div>
  </div>

  <script>
    const dataSampel = [
      {
        barcode: 'SMP001',
        pasien: 'Andi',
        uji: 'Glukosa',
        tanggal: '2025-08-03',
        status: 'diambil',
        waktu: Date.now() - 3 * 60 * 60 * 1000 // 3 jam lalu
      },
      {
        barcode: 'SMP002',
        pasien: 'Budi',
        uji: 'HbA1c',
        tanggal: '2025-08-03',
        status: 'diuji',
        waktu: Date.now() - 30 * 60 * 1000 // 30 menit lalu
      }
    ];

    const statusOrder = ['diambil', 'sentrifugasi', 'diuji', 'selesai'];

    function renderTable(data) {
      const tbody = document.getElementById('sampelBody');
      tbody.innerHTML = '';

      data.forEach((s, index) => {
        const tr = document.createElement('tr');

        const badgeColor = s.status === 'selesai' ? '#F4A261' : '#FFDDD2';
        const now = Date.now();
        const overdue = s.status !== 'selesai' && (now - s.waktu > 2 * 60 * 60 * 1000);

        tr.innerHTML = `
          <td>${s.barcode}</td>
          <td>${s.pasien}</td>
          <td>${s.uji}</td>
          <td>${s.tanggal}</td>
          <td>
            <span class="badge" style="background-color:${badgeColor}">${s.status}</span>
            ${overdue ? '<span class="reminder">⏰ >2 jam</span>' : ''}
          </td>
          <td>${new Date(s.waktu).toLocaleTimeString()}</td>
          <td>
            ${s.status !== 'selesai' ? `<button class="nextBtn" onclick="ubahStatus(${index})">Next</button>` : '-'}
          </td>
        `;

        tbody.appendChild(tr);
      });
    }

    function ubahStatus(index) {
      const current = dataSampel[index].status;
      const nextIndex = statusOrder.indexOf(current) + 1;
      if (nextIndex < statusOrder.length) {
        dataSampel[index].status = statusOrder[nextIndex];
        dataSampel[index].waktu = Date.now(); // update waktu proses
        renderTable(dataSampel);
      }
    }

    function searchByBarcode() {
      const value = document.getElementById('barcodeInput').value.trim().toLowerCase();
      const filtered = dataSampel.filter(s => s.barcode.toLowerCase().includes(value));
      renderTable(filtered);
    }

    function applyFilter() {
      const tgl = document.getElementById('filterTanggal').value;
      const status = document.getElementById('filterStatus').value;
      const pasien = document.getElementById('filterPasien').value.toLowerCase();
      const uji = document.getElementById('filterUji').value.toLowerCase();

      const filtered = dataSampel.filter(s => {
        return (!tgl || s.tanggal === tgl) &&
               (!status || s.status === status) &&
               s.pasien.toLowerCase().includes(pasien) &&
               s.uji.toLowerCase().includes(uji);
      });

      renderTable(filtered);
    }

    renderTable(dataSampel);

    const sidebar = document.getElementById("sidebar");
  let isBtnClick = false;
  function openSide(){
    isBtnClick = !isBtnClick;
    isBtnClick? sidebar.style.marginLeft = 0+"px" : sidebar.style.marginLeft = -260+"px";
  }
  </script>
</body>
</html>
